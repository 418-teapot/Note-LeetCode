# 乘积小于 K 的子数组

难度： 中等

关键词： 滑动窗口

## 题目描述

给你一个整数数组 `nums` 和一个整数 `k` ，请你返回子数组内所有元素的乘积严格小于 `k` 的连续子数组的数目。

示例 1：

>**输入**： `nums = [10,5,2,6], k = 100` <br>
**输出**： `8` <br>
**解释**： 8 个乘积小于 100 的子数组分别为： `[10]、[5]、[2],、[6]、[10,5]、[5,2]、[2,6]、[5,2,6]`。需要注意的是 `[10,5,2]` 并不是乘积小于 100 的子数组。

示例 2：

>**输入**： `nums = [1,2,3], k = 0` <br>
**输出**： `0`

提示: 

* `1 <= nums.length <= 3 * 10^4`
* `1 <= nums[i] <= 1000`
* `0 <= k <= 10^6`

## 题解

### 滑动窗口

#### 思路及算法

我们固定子数组 $[i, j]$ 的右端点 $j$ 时，显然左端点 $i$ 越大，子数组元素乘积越小。对于子数组 $[i, j]$，当左端点 $i \ge l_1$​ 时，所有子数组的元素乘积都小于 $k$，当左端点 $i \lt l_1$​ 时，所有子数组的元素乘积都大于等于 $k$。那么对于右端点为 $j + 1$ 的所有子数组，它的左端点 $i$ 就不需要从 $0$ 开始枚举，因为对于所有 $i \lt l_1$​ 的子数组，它们的元素乘积都大于等于 $k$。我们只要从 $i = l_1$​ 处开始枚举，直到子数组 $i = l_2$​ 时子数组 $[l_2, j + 1]$ 的元素乘积小于 $k$，那么左端点 $i \ge l_2$​ 所有子数组的元素乘积都小于 $k$。

根据上面的分析，我们枚举子数组的右端点 $j$，并且左端点从 $i = 0$ 开始，用 $cur$ 记录子数组 $[i, j]$ 的元素乘积。每枚举一个右端点 $j$，如果当前子数组元素乘积 $cur$ 大于等于 $k$，那么我们右移左端点 $i$ 直到满足当前子数组元素乘积小于 $k$ 或者 $i > j$，那么元素乘积小于 $k$ 的子数组数目为 $j - i + 1$。返回所有数目之和。

#### 代码

```cpp
class Solution {
 public:
  int numSubarrayProductLessThanK(vector<int>& nums, int k) {
    int n = nums.size();
    int res = 0, cur = 1;
    for (int i = 0, j = 0; j < n; ++j) {
      cur *= nums[j];
      while (i <= j && cur >= k) cur /= nums[i++];
      res += j - i + 1;
    }
    return res;
  }
};
```

#### 复杂度分析

* 时间复杂度： $O(n)$，其中 $n$ 是数组 $nums$ 的长度。两个端点 $i$ 和 $j$ 的增加次数都不超过 $n$。
* 空间复杂度： $O(1)$。